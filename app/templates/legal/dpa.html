{% extends "base_auth.html" %}

{% block title %}Data Processing Agreement (DPA){% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <h1 class="mb-4">Data Processing Agreement (DPA)</h1>
            <p class="text-muted">Last updated: June 20, 2025</p>
            <form method="POST" class="mb-4 p-3 border rounded bg-light">
                <div class="row g-3 align-items-end">
                    <div class="col-md-4">
                        <label for="clinic_name" class="form-label">Clinic Name</label>
                        <input type="text" class="form-control" id="clinic_name" name="clinic_name" value="{{ clinic_name }}" placeholder="e.g. Marbella Physio Center">
                    </div>
                    <div class="col-md-4">
                        <label for="clinic_address" class="form-label">Clinic Address</label>
                        <input type="text" class="form-control" id="clinic_address" name="clinic_address" value="{{ clinic_address }}" placeholder="e.g. Calle Falsa 123, Marbella">
                    </div>
                    <div class="col-md-4">
                        <label for="clinic_rep" class="form-label">Clinic Representative</label>
                        <input type="text" class="form-control" id="clinic_rep" name="clinic_rep" value="{{ clinic_rep }}" placeholder="e.g. Dr. Ana López">
                    </div>
                </div>
                <div class="mt-3 d-flex align-items-center">
                    <button type="submit" class="btn btn-primary me-3">Update DPA</button>
                    <span class="text-muted small">Need help? <a href="mailto:legal@trxck.com">Contact us</a></span>
                </div>
            </form>
            <div class="card">
                <div class="card-body">
                    <h2>1. Parties</h2>
                    <p>
                        <strong>Data Controller (Clinic):</strong> {{ clinic_name or '[Clinic Name]' }}, {{ clinic_address or '[Clinic Address]' }}<br>
                        <strong>Data Processor:</strong> Haim Ganancia, Calle Resinera 74, Estepona, Málaga, Spain<br>
                        <strong>Platform:</strong> TRXCK (PhysioTracker)
                    </p>
                    <h2>2. Subject Matter</h2>
                    <p>This DPA governs the processing of personal data by TRXCK on behalf of the Clinic in connection with the provision of physiotherapy management services.</p>
                    <h2>3. Duration</h2>
                    <p>This DPA is effective for as long as the Clinic uses TRXCK services and personal data is processed on its behalf.</p>
                    <h2>4. Nature & Purpose of Processing</h2>
                    <ul>
                        <li>Storage and management of patient records</li>
                        <li>Treatment planning and clinical documentation</li>
                        <li>Appointment scheduling and reminders</li>
                        <li>Billing and payment processing</li>
                        <li>Analytics and reporting</li>
                    </ul>
                    <h2>5. Types of Personal Data</h2>
                    <ul>
                        <li>Patient names, contact details, and demographic data</li>
                        <li>Medical history, clinical notes, and treatment plans</li>
                        <li>Appointment and billing information</li>
                        <li>Clinician user account data</li>
                    </ul>
                    <h2>6. Categories of Data Subjects</h2>
                    <ul>
                        <li>Patients of the Clinic</li>
                        <li>Clinic staff and clinicians</li>
                    </ul>
                    <h2>7. Security & Monitoring</h2>
                    <ul>
                        <li>AES-256 encryption for data at rest and in transit</li>
                        <li>HTTPS secure connections</li>
                        <li>Role-based access control and authentication</li>
                        <li>Regular security audits and penetration testing</li>
                        <li>Data backups and disaster recovery procedures</li>
                        <li><strong>Access Logging:</strong> Access to patient data is logged and monitored to prevent unauthorized use. Audit trails are maintained for compliance and security purposes.</li>
                    </ul>
                    <h2>8. Rights & Obligations</h2>
                    <h4>8.1 Data Processor (TRXCK) Obligations</h4>
                    <ul>
                        <li>Process data only on documented instructions from the Clinic</li>
                        <li>Ensure confidentiality and train staff on data protection</li>
                        <li>Assist the Clinic in fulfilling data subject rights (access, rectification, erasure, etc.)</li>
                        <li>Notify the Clinic of any data breaches without undue delay</li>
                        <li>Maintain records of processing activities</li>
                        <li>Allow audits by the Clinic or its representatives</li>
                        <li>Use subprocessors only with Clinic's consent and under a written agreement</li>
                        <li><strong>Data Subject Requests Support:</strong> TRXCK will assist the Clinic in responding to data subject requests under GDPR Articles 12–23, including access, rectification, objection, and portability. This includes providing technical support and data export capabilities.</li>
                    </ul>
                    <h4>8.2 Data Controller (Clinic) Obligations</h4>
                    <ul>
                        <li>Obtain valid consent from patients/data subjects</li>
                        <li>Provide processing instructions to TRXCK</li>
                        <li>Comply with all applicable data protection laws</li>
                    </ul>
                    <h2>9. Subprocessors</h2>
                    <p>TRXCK may engage trusted subprocessors (e.g., hosting, payment providers) under written agreements ensuring equivalent data protection. A list of subprocessors is available upon request.</p>
                    <h2>10. Data Retention & Deletion</h2>
                    <p>Personal data is retained only as long as necessary for the purposes described or as required by law. Upon termination of the service or at the Clinic's request, TRXCK will securely delete or return all personal data, unless retention is required by law.</p>
                    <h2>11. International Transfers</h2>
                    <p>Any transfer of personal data outside the EEA will be subject to appropriate safeguards, such as Standard Contractual Clauses or adequacy decisions.</p>
                    <h2>12. Liability</h2>
                    <p>Each party is liable for breaches of this DPA and applicable data protection law to the extent of its responsibility.</p>
                    <h2>13. Governing Law & Jurisdiction</h2>
                    <p>This DPA is governed by the laws of Spain. Any disputes will be resolved in the courts of Marbella, Málaga, Spain.</p>
                    <h2>14. Contact Information</h2>
                    <p><strong>For privacy-related questions and data protection queries:</strong><br>
                    Contact: <a href="mailto:privacy@trxck.com">privacy@trxck.com</a><br>
                    Address: Calle Resinera 74, Estepona, Málaga, Spain</p>
                    <h2>15. Digital Agreement</h2>
                    <div class="border rounded p-3 bg-light">
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" id="dpa_agreement">
                            <label class="form-check-label" for="dpa_agreement">
                                <strong>I agree to the terms of this Data Processing Agreement</strong>
                            </label>
                        </div>
                        <div class="row g-3">
                            <div class="col-md-4">
                                <label for="typed_name" class="form-label">Typed Name (Clinic Representative)</label>
                                <input type="text" class="form-control" id="typed_name" placeholder="{{ clinic_rep or 'Enter your full name' }}">
                            </div>
                            <div class="col-md-4">
                                <label for="agreement_date" class="form-label">Date</label>
                                <input type="date" class="form-control" id="agreement_date">
                            </div>
                            <div class="col-md-4">
                                <label for="digital_signature" class="form-label">Digital Signature</label>
                                <input type="text" class="form-control" id="digital_signature" placeholder="Type your name as signature">
                            </div>
                        </div>
                        <div class="mt-3">
                            <button type="button" class="btn btn-success" onclick="submitDPA()">Submit Digital Agreement</button>
                            <span class="text-muted small ms-2">This constitutes a legally binding digital signature</span>
                        </div>
                    </div>
                    <h2>16. Traditional Signatures (Alternative)</h2>
                    <p>
                        <strong>For the Data Controller (Clinic):</strong><br>
                        Name: {{ clinic_rep or '[Clinic Representative]' }}<br>
                        Signature: _______________________<br>
                        Date: _______________________<br><br>
                        <strong>For the Data Processor (TRXCK):</strong><br>
                        Name: Haim Ganancia<br>
                        Signature: _______________________<br>
                        Date: _______________________<br>
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function submitDPA() {
    const agreement = document.getElementById('dpa_agreement').checked;
    const typedName = document.getElementById('typed_name').value;
    const date = document.getElementById('agreement_date').value;
    const signature = document.getElementById('digital_signature').value;
    
    if (!agreement) {
        alert('Please check the agreement checkbox to proceed.');
        return;
    }
    
    if (!typedName || !date || !signature) {
        alert('Please fill in all required fields.');
        return;
    }
    
    // Here you could send the data to your backend for processing
    alert('Thank you! Your digital agreement has been submitted. We will contact you shortly to finalize the DPA.');
    
    // Optional: Send to backend endpoint
    // fetch('/api/dpa-submission', {
    //     method: 'POST',
    //     headers: {'Content-Type': 'application/json'},
    //     body: JSON.stringify({
    //         clinic_name: document.getElementById('clinic_name').value,
    //         clinic_address: document.getElementById('clinic_address').value,
    //         clinic_rep: document.getElementById('clinic_rep').value,
    //         typed_name: typedName,
    //         date: date,
    //         signature: signature
    //     })
    // });
}
</script>
{% endblock %}

 